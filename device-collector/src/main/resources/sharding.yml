dataSources:
  shard0_master:
    dataSourceClassName: com.zaxxer.hikari.HikariDataSource
    jdbcUrl: jdbc:postgresql://localhost:5433/postgres
    username: postgres
    password: postgres
  shard0_replica:
    dataSourceClassName: com.zaxxer.hikari.HikariDataSource
    jdbcUrl: jdbc:postgresql://localhost:5434/postgres
    username: postgres
    password: postgres
  shard1_master:
    dataSourceClassName: com.zaxxer.hikari.HikariDataSource
    jdbcUrl: jdbc:postgresql://localhost:5455/postgres
    username: postgres
    password: postgres
  shard1_replica:
    dataSourceClassName: com.zaxxer.hikari.HikariDataSource
    jdbcUrl: jdbc:postgresql://localhost:5435/postgres
    username: postgres
    password: postgres

rules:
  - !READWRITE_SPLITTING
    dataSourceGroups:
      shard0:
        writeDataSourceName: shard0_master
        readDataSourceNames:
          - shard0_replica
        loadBalancerName: round_robin
      shard1:
        writeDataSourceName: shard1_master
        readDataSourceNames:
          - shard1_replica
        loadBalancerName: round_robin
    loadBalancers:
      round_robin:
        type: ROUND_ROBIN

  - !SHARDING
    tables:
      devices:
        actualDataNodes: shard${0..1}.devices
        tableStrategy:
          none:
        databaseStrategy:
          standard:
            shardingColumn: device_id
            shardingAlgorithmName: deviceid_hash_mod
    shardingAlgorithms:
      deviceid_hash_mod:
        type: INLINE
        props:
          algorithm-expression: shard${Math.abs(device_id.hashCode()) % 2}